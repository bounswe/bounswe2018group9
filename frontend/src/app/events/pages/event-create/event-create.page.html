<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/feed"></ion-back-button>
    </ion-buttons>
    <ion-title style="font-family: 'Garamond'; font-weight: bold;">
      Event
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid>
    <ion-row>
      <ion-col col-xs-12>
        <div class="event-form-container">
          <form [formGroup]="form" (ngSubmit)="createEvent()">

            <ion-list lines="none">

              <ion-item>
                <div class="event-image">
                  <img #eventImage
                       (error)="onImageError()"
                       (load)="onImageLoad()"
                       [src]="this.form.get('medias').value[0]"
                       alt="Event image">
                </div>
              </ion-item>

              <ion-item formArrayName="medias">
                <ion-label position="stacked">
                  Url of the image
                  <span class="input-required">
                  *
                </span>
                  <span class="input-error" *ngIf="this.form.get('medias').at(0).dirty && !this.form.get('medias').at(0).valid">
                  (you should add an image link)
                </span>
                </ion-label>
                <ion-input type="url"
                           formControlName="0"
                           class="form-input">
                </ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">
                  Name of the event
                  <span class="input-required">
                  *
                </span>
                  <span class="input-error" *ngIf="this.form.get('name').dirty && !this.form.get('name').valid">
                  (your event should have a name)
                </span>
                </ion-label>
                <ion-input type="text"
                           max="150"
                           formControlName="name"
                           class="form-input">
                </ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">
                  Describe your event
                  <span class="input-required">
                  *
                </span>
                  <span class="input-error" *ngIf="this.form.get('description').dirty && !this.form.get('description').valid">
                  (you should describe your event, min: 20 character)
                </span>
                </ion-label>
                <ion-textarea type="text"
                              formControlName="description"
                              class="form-input">
                </ion-textarea>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">
                  When it will start
                  <span class="input-required">
                  *
                </span>
                  <span class="input-error" *ngIf="this.form.get('date').dirty && !this.form.get('date').valid">
                  (you should specify start date and time)
                </span>
                </ion-label>
                <ion-datetime
                  display-format="DD MMMM DDDD HH:mm, YYYY"
                  picker-format="DD MMM HH mm YYYY"
                  formControlName="date"
                  placeholder="Choose a date"
                  class="form-input">
                </ion-datetime>
              </ion-item>

              <ion-item-group formGroupName="duration">
                <ion-item>
                  <ion-label position="stacked">
                    How long it will take
                    <span class="input-required">
                  *
                </span>
                    <span class="input-error" *ngIf="this.form.get('date').dirty && !this.form.get('date').valid">
                  (you should specify the duration)
                </span>
                  </ion-label>
                  <ion-input
                    type="number"
                    formControlName="length"
                    class="form-input">{{duration.value}}
                  </ion-input>
                </ion-item>
                <ion-item>
                  <ion-select formControlName="unit" mode="md" #duration placeholder="Select time unit">
                    <ion-select-option value ='minute' >Minute</ion-select-option>
                    <ion-select-option value ='hour' >Hour</ion-select-option>
                    <ion-select-option value ='day' >Day</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-item-group>

              <ion-item formGroupName="locationConstruct">
                <ion-label position="stacked">
                  Where it will happen
                  <span class="input-required">
                  *
                </span>
                  <span class="input-error" *ngIf="this.form.get('locationConstruct').get('locationName').dirty && !this.form.get('locationConstruct').get('locationName').valid">
                  (you should specify location name)
                </span>
                </ion-label>
                <ion-input
                  type="text"
                  formControlName="locationName"
                  class="form-input">
                </ion-input>
              </ion-item>

              <ion-item-group>
                <ion-item>
                    <ion-label>
                      Your event is free
                    </ion-label>
                    <ion-checkbox item-content formControlName="isFree">
                    </ion-checkbox>
                </ion-item>

                <ion-item-group formGroupName="price" *ngIf="!this.form.get('isFree').value">
                  <ion-item>
                    <ion-label position="stacked">
                      What is its price
                      <span class="input-required">
                  *
                </span>
                      <span class="input-error" *ngIf="this.form.get('price').get('amount').dirty && !this.form.get('price').get('amount').valid">
                  (you should specify price)
                </span>
                    </ion-label>
                    <ion-input
                      align="right"
                      type="number"
                      formControlName="amount"
                      class="form-input">{{currency.value}}
                    </ion-input>
                  </ion-item>
                  <ion-item>
                    <ion-select formControlName="currency" mode="md" #currency placeholder="Select currency">
                      <ion-select-option value ='₺' >Turkish Lira</ion-select-option>
                      <ion-select-option value ='$' >Dollars</ion-select-option>
                      <ion-select-option value ='€' >Euro</ion-select-option>
                    </ion-select>
                  </ion-item>
                </ion-item-group>
              </ion-item-group>

              <ion-item-group formArrayName="artists">
                <ion-item>
                  <ion-label position="stacked">
                    Add an artist/artists
                    <ion-button class="inline-block" (click)="addArtist()">
                      +
                    </ion-button>
                  </ion-label>
                </ion-item>
                <ion-item *ngFor="let artist of artists.controls; let i=index">
                  <div class="flex-container">
                    <ion-input
                      type="text"
                      [formControlName]="i"
                      [placeholder]="'Artist' + (i+1)"
                      class="form-input inline-block">
                    </ion-input>
                    <ion-button class="inline-block" (click)="removeArtist(i)">
                      -
                    </ion-button>
                  </div>
                </ion-item>
              </ion-item-group>
              <ion-button ion-item type="submit" [disabled]="!form.valid">
                <ion-icon item-start name="share"></ion-icon>
                Share your experience
              </ion-button>
            </ion-list>

          </form>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
